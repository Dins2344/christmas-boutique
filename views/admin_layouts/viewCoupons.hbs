<script src="/tableSetter/js/jquery.js"></script>
<script src="/tableSetter/media/js/jquery.dataTables.min.js"></script>
<script>
    $(document).ready(function () {
        $('#couponTable').dataTable()
    })
</script>

{{!-- admin side pages --}}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/adminCss/style.css">




<div class=" d-flex align-items-stretch  ">
   <nav style="background-color: rgb(255, 255, 255);" id="sidebar" class="sidebar">
        <div class="custom-menu">
            <button type="button" id="sidebarCollapse" class="btn btn-dark">
                <i class="fa fa-bars"></i>
                <span class="sr-only">Toggle Menu</span>
            </button>
        </div>
        <div class="p-4 pt-5">
            <div class="col-12 pe-2 ps-2">
                <div class="row border border-2 rounded-3 mb-2">
                    <p style="color: black;"  class="m-0 mt-2">
                        Hello..
                    </p>
                    <h5 class="m-0">
                        admin
                    </h5>
                </div>
            </div>
            <ul class="list-unstyled components mb-5">
                <li class="active">
                    <a href="#homeSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Home</a>
                    <ul class="collapse list-unstyled" id="homeSubmenu">
                        <li>
                            <a href="#">Home 1</a>
                        </li>
                        <li>
                            <a href="#">Home 2</a>
                        </li>
                        <li>
                            <a href="#">Home 3</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a style="color: black;"  href="/admin">
                        <i class="fa fa-clipboard " style="color: rgb(0, 0, 0);  margin-right: 5px;"
                            aria-hidden="true"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a style="color: black;"  href="/admin/viewusers">
                        <i class="fa fa-users " style="color: rgb(0, 0, 0); margin-right: 5px;"
                            aria-hidden="true"></i>
                        View Users
                    </a>
                </li>
                <li>
                    <a style="color: black;"  href="/admin/viewproducts">
                        <i class="fa fa-shopping-bag" style="color: rgb(0, 0, 0);  margin-right: 5px;"
                            aria-hidden="true"></i>
                        View Products
                    </a>
                </li>
                <li>
                    <a style="color: black;"  href="/admin/category">
                        <i class="fa fa-list-alt" style="color: rgb(0, 0, 0);  margin-right: 5px;"
                            aria-hidden="true"></i>
                        Category Management
                    </a>
                </li>
                <li>
                    <a style="color: black;"  href="/admin/orders">
                        <i class="fas fa-shipping-fast" style="color: rgb(0, 0, 0);  margin-right: 5px;"
                            aria-hidden="true"></i>
                        Order Management
                    </a>
                </li>
                 <li>
                    <a style="color: black;" href="/admin/order-return-requests">
                        <i class="fa fa-undo" style="color: rgb(0, 0, 0);  margin-right: 5px;" aria-hidden="true"></i>
                        Order Return Requests
                    </a>
                </li>
                 <li>
                    <a style="color: black;" href="/admin/refund-requests">
                        <i class=" fas fa-hand-holding-usd" style="color: rgb(0, 0, 0);  margin-right: 5px;" aria-hidden="true"></i>
                        Refund Requests
                    </a>
                </li>
                <li>
                    <a style="color: black;"  href="#pageSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        <i class="fa fa-gift" style="color: rgb(0, 0, 0);  margin-right: 5px;"
                            aria-hidden="true"></i>
                        Offer Management</a>
                    <ul class="collapse list-unstyled" id="pageSubmenu">
                        <li style="background-color: rgb(247, 240, 230);" class="rounded-1 ps-1">
                            <a style="color: black;"  href="/admin/coupons">
                                Coupon Management
                            </a>
                        </li>
                        <li>
                            <a style="color: black;"  href="/admin/add-product-offer">
                                Product Offer Management
                            </a>
                        </li>
                        <li >
                            <a style="color: black;"  href="/admin/category-offers">
                                Category Offer Management
                            </a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a style="color: black;" >
                        <i class="fa fa-gear" style="color: rgb(0, 0, 0);  margin-right: 5px;"
                            aria-hidden="true"></i>
                        Profile Setting
                    </a>
                </li>
                <li>
                    <a onclick="logoutConfirm()" style="color: black; cursor: pointer;">
                        <i class="fa fa-sign-out" style="color: rgb(0, 0, 0);  margin-right: 5px;"
                            aria-hidden="true"></i>
                        Logout</a>
                </li>
            </ul>

        </div>
    </nav>

  <!-- Page Content  -->
  <div id="content" class="p-4 p-md-5 pt-5">
    <div class="container mb-3">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__text">
                        <div class="breadcrumb__links">
                            <a style="color: black;" href="/admin/coupons">/Offer management</a>
                            <a style="color: black;" href="/admin/coupons">/Coupon management</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <div class="d-flex justify-content-center mt-3">
      <h3 style="font-family:Times New Roman, Times, serif; font-style: italic;">
        Coupon Management
      </h3>
    </div>
    <div class="container mt-4">
      {{! create coupon container }}
      <div class="container mb-4 mt-3">
        <h3>Add Coupon
          <span id="couponSubmitErr" class="d-block text-center text-danger"></span>
        </h3>

        <form id="addCoupon" class="bg-white p-4 rounded-4">
          <div class="form-group px-3">
            <div class="d-flex justify-content-between row">
              <label for="coupon_code">Coupon Code:<span id="couponCodeErr"
                  class="text-center text-danger"></span></label>
              <input onkeyup="checkCodeCoupon()" type="text" class="form-control border w-50" id="couponCode"
                placeholder="Enter coupon code" name="couponCode" />

              <button onclick="return couponSubmitCheck()" class="btn btn-sm btn-success w-25">
                Create Coupon
              </button>
            </div>
          </div>
          <div class="form-group d-flex justify-content-between row px-1">
            <div class="w-25">
              <label for="couponType">Coupon Type:<span id="couponTypeErr"
                  class="text-center text-danger"></span></label>
              <input onkeyup="checkCodeTypeCoupon()" type="text" class="form-control border" id="couponType"
                placeholder="Enter coupon type" name="couponType" />
            </div>
            <div class="w-25">
              <label for="couponDiscount">Discount:<span id="couponDiscErr"
                  class="text-center text-danger"></span></label>
              <input onkeyup="checkCouponDiscount()" type="text" class="form-control border" id="couponDiscount"
                placeholder="Enter discount amount" name="discount" />
            </div>
            <div class="w-25">
              <label for="minLimit">Min purchase limit:<span id="couponMimLimitErr"
                  class="text-center text-danger"></span>
              </label>
              <input onkeyup="checkCouponMinLimit()" type="text" class="form-control border" id="minLimit"
                placeholder="Enter minimum purchase amount" name="minLimit" />
            </div>
            <div class="w-25">
              <label for="maxDis">Max Limit:<span id="couponMaxLimitErr" class="text-center text-danger"></span></label>
              <input onkeyup="checkCouponMaxLimit()" type="text" class="form-control border" id="maxDis"
                placeholder="Enter maximum discount limit" name="maxDis" />
            </div>
          </div>
          <div class="form-group d-flex justify-content-between row px-1 pb-2">
            <div class="w-50">
              <label for="start_date">Start Date:</label>
              <input type="date" class="form-control border" id="start_date" name="startDate" />
            </div>
            <div class="w-50">
              <label for="expiry_date">Expiry Date:</label>
              <input type="date" class="form-control border" id="expiry_date" name="expiryDate" />
            </div>
          </div>
        </form>
      </div>

      {{! coupon showing table }}
      <div class="container mt-4">
        <h3 class="mb-2 mt-2">Available Coupons</h3>
        <div class="bg-white p-4 rounded-4">
          <table id="couponTable" class="table table-hover">
          <thead>
            <tr>
              <th scope="col">Coupon Code</th>
              <th scope="col">Coupon Discount</th>
              <th scope="col">Coupon Type</th>
              <th scope="col">Start Date</th>
              <th scope="col">Expiry Date</th>
              <th scope="col">Coupon Status</th>
              <th scope="col"></th>
              
            </tr>
          </thead>
          <tbody>
            {{#each coupons}}
            <tr>
              <td>{{couponCode}}</td>
              <td>{{discount}}</td>
              <td>{{couponType}}</td>
              <td>{{startDate}}</td>
              <td>{{expiryDate}}</td>
              <td>{{couponStatus}}</td>
              <td>
                <div class="row btn-group">
                  <!-- Button trigger modal -->
                  <button type="button" class="btn p-0 m-0" data-bs-toggle="modal" data-bs-target="#{{_id}}">
                    <i class="fa fa-edit" style="font-size:24px; color: black;"></i>
                  </button>
                  <button onclick="deleteConfirm('{{_id}}')" class="btn p-0 m-0">
                    <i style="color:rgb(246, 60, 60) ;" class="fa fa-trash "></i>
                  </button>
                </div>
                <!-- Modal -->
                <div class="modal fade" id="{{_id}}" tabindex="-1" aria-labelledby="exampleModalLabel"
                  aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>
                      <div class="modal-body">
                        <form action="/admin/edit-coupon" id="editCoupon" class="border border-2 rounded">
                          <input value="{{_id}}" name="couponId" hidden />
                          <div class="form-group px-3">
                            <div class="d-flex justify-content-between row">
                              <label for="coupon_code">Coupon Code:</label>
                              <input type="text" class="form-control w-50" id="coupon_code" value="{{couponCode}}"
                                name="couponCode" />
                              <button class="btn btn-sm btn-success w-25">Save
                                Changes</button>
                            </div>
                          </div>
                          <div class="form-group d-flex justify-content-between row px-1">
                            <div class="w-50">
                              <label for="coupon_type">Coupon Type:</label>
                              <input type="text" class="form-control" id="coupon_type" value="{{couponType}}"
                                name="couponType" />
                            </div>
                            <div class="w-50">
                              <label for="discount">Discount:</label>
                              <input type="text" class="form-control" id="discount" value="{{discount}}"
                                name="discount" />
                            </div>
                          </div>
                          <div class="form-group d-flex justify-content-between row px-1 pb-2">
                            <div class="w-50">
                              <label for="start_date">Start Date:</label>
                              <input type="date" class="form-control" id="start_date" value="{{startDate}}"
                                name="startDate" />
                            </div>
                            <div class="w-50">
                              <label for="expiry_date">Expiry Date:</label>
                              <input type="date" class="form-control" id="expiry_date" value="{{expiryDate}}"
                                name="expiryDate" />
                            </div>
                          </div>
                        </form>
                      </div>

                    </div>
                  </div>
                </div>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
        </div>
        
      </div>
    </div>

  </div>
</div>

<script src="/adminJs/popper.js"></script>
<script src="/adminJs/bootstrap.min.js"></script>
<script src="/adminJs/main.js"></script>



<script>
  $('#addCoupon').submit((e) => {
    e.preventDefault()
    $.ajax({
      type: 'POST',
      url: ('/admin/coupons'),
      data: $('#addCoupon').serialize(),
      success:
        (response) => {
          if (response.status) {
           swal("Successfully Added Coupon", "you can see the details below", "success").then(()=>{

            location.reload()
           })
          }
        },
      error:
        (response, stat, err) => {
          if (err) console.log(response)
        }
    })
  })
</script>